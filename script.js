/* LMSY Schedule app script (generated) */
const events = [
  {
    date: "2024-05-23",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "10.00 AM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-06-05",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "10.00 AM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-06-18",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "10.00 AM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-06-20",
    type: "Series",
    title_en: "Affair The Series Artist Schedule",
    title_th: "ตารางงานนักแสดงซีรีส์ Affair",
    title_zh: "《Affair》系列艺人行程",
    artists: "Lookmhee, Sonya, Pop",
    time: "10.00 AM",
    venue: "GMM Grammy Lobby",
    hashtag: "#Affairรักเล่นกล"
  },
  {
    date: "2024-07-01",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "11.00 AM to 03.00 PM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-07-03",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "11.00 AM to 03.00 PM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-07-10",
    type: "Tour",
    title_en: "MaMa OK Presents ฟีออย ฟีออด ON TOUR",
    title_th: "มาม่า OK Presents ฟีออย ฟีออด ON TOUR",
    title_zh: "MaMa OK Presents 巡演",
    artists: "Lookmhee and Sonya",
    time: "11.00 AM to 03.00 PM",
    venue: "Not stated (see poster)",
    hashtag: "#มาม่าOKPresentฟีออยฟีออดOnTour"
  },
  {
    date: "2024-08-30",
    type: "Series",
    title_en: "Affair The Series First Episode Watch Party",
    title_th: "งานรับชมตอนแรกซีรีส์ Affair",
    title_zh: "《Affair》第一集观影会",
    artists: "Lookmhee, Sonya, Pop",
    time: "06.00 PM",
    venue: "House Samyan, 5th Floor, Samyan Mitrtown",
    hashtag: "#Affair1stEPWatchParty"
  },
  {
    date: "2024-09-06",
    type: "Press",
    title_en: "Affair Press Tour",
    title_th: "Affair Press Tour",
    title_zh: "《Affair》媒体宣传行程",
    artists: "Lookmhee and Sonya",
    time: "09.30 AM onwards",
    venue: "Multiple media stations",
    hashtag: "#AffairPressTour"
  },
  {
    date: "2024-09-07",
    type: "Awards",
    title_en: "Praew Charity 2024",
    title_th: "Praew Charity 2024",
    title_zh: "Praew 慈善活动 2024",
    artists: "Lookmhee and Sonya",
    time: "05.00 PM",
    venue: "Paragon Hall, Siam Paragon",
    hashtag: "#PraewCharity2024"
  },
  {
    date: "2024-09-17",
    type: "Press",
    title_en: "Affair Press Tour (Media Rounds)",
    title_th: "Affair Press Tour (รอบสื่อ)",
    title_zh: "《Affair》媒体采访",
    artists: "Lookmhee and Sonya",
    time: "04.30 PM and 06.00 PM",
    venue: "Media studios",
    hashtag: "#AffairPressTour"
  },
  {
    date: "2024-09-21",
    type: "Awards",
    title_en: "FEED Y Awards 2024",
    title_th: "FEED Y Awards 2024",
    title_zh: "FEED Y 颁奖礼 2024",
    artists: "Lookmhee and Sonya",
    time: "05.00 PM",
    venue: "Paragon Hall, Siam Paragon",
    hashtag: "#FeedYAwards2024"
  },
  {
    date: "2024-10-03",
    type: "Brand",
    title_en: "Wan Sang Suk Market x LMSY",
    title_th: "วันสร้างสุข x LMSY",
    title_zh: "幸福市集 × LMSY",
    artists: "Lookmhee and Sonya",
    time: "03.00 PM",
    venue: "Central Westville, G Floor, Waterfall Amphitheatre",
    hashtag: "#วันสร้างสุขxLMSY"
  },
  {
    date: "2024-10-03",
    type: "Live",
    title_en: "EFM Fandom Live",
    title_th: "EFM Fandom Live",
    title_zh: "EFM 粉丝直播",
    artists: "Lookmhee and Sonya",
    time: "08.30 PM",
    venue: "Online and studio",
    hashtag: "#LMSYxEFMFandomLive"
  },
  {
    date: "2024-10-10",
    type: "Fashion",
    title_en: "ELLE Fashion Week 2024 (Sretsis)",
    title_th: "ELLE Fashion Week 2024 (Sretsis)",
    title_zh: "ELLE 时装周 2024（Sretsis）",
    artists: "Lookmhee and Sonya",
    time: "07.30 PM",
    venue: "True Icon Hall, ICONSIAM",
    hashtag: "#EFW2024"
  },
  {
    date: "2024-10-18",
    type: "Series",
    title_en: "Affair The Series Final Episode Screening",
    title_th: "Affair The Series ตอนจบ",
    title_zh: "《Affair》大结局放映",
    artists: "Lookmhee and Sonya",
    time: "07.00 PM",
    venue: "Siam Pavalai Royal Grand Theatre, Siam Paragon",
    hashtag: "#AffairTheSeriesFinalEP"
  },
  {
    date: "2024-10-25",
    type: "Brand",
    title_en: "ONE Bangkok Grand Opening",
    title_th: "งานเปิดตัว ONE Bangkok",
    title_zh: "ONE Bangkok 开幕活动",
    artists: "Lookmhee and Sonya",
    time: "07.30 PM",
    venue: "ONE Bangkok",
    hashtag: "#OneBangkokxLMSY"
  },
  {
    date: "2024-10-27",
    type: "Brand",
    title_en: "Destiny Clinic Event",
    title_th: "กิจกรรม Destiny Clinic",
    title_zh: "Destiny Clinic 活动",
    artists: "Lookmhee and Sonya",
    time: "05.30 PM",
    venue: "Central Rama 3",
    hashtag: "#DestinyclinicLookmheeSonya"
  },
  {
    date: "2024-11-01",
    type: "Brand",
    title_en: "iQIYI iJOY TH 2025",
    title_th: "iQIYI iJOY TH 2025",
    title_zh: "iQIYI iJOY 泰国 2025",
    artists: "Lookmhee (solo)",
    time: "03.00 PM",
    venue: "EMSPHERE",
    hashtag: "#iQIYIiJOYTH2025"
  },
  {
    date: "2024-11-02",
    type: "Brand",
    title_en: "MAMI Puppy Love Moment",
    title_th: "MAMI Puppy Love Moment",
    title_zh: "MAMI Puppy Love Moment 活动",
    artists: "Lookmhee and Sonya",
    time: "03.00 PM",
    venue: "Not stated",
    hashtag: "#MAMIxLookmheeSonya"
  },
  {
    date: "2024-11-07",
    type: "Live",
    title_en: "Taobao Live (Pandathaihouse)",
    title_th: "ไลฟ์ Taobao (Pandathaihouse)",
    title_zh: "淘宝直播（Pandathaihouse）",
    artists: "Lookmhee and Sonya",
    time: "07.00 PM",
    venue: "Taobao Live",
    hashtag: "#Pandathaihouse"
  },
  {
    date: "2024-11-09",
    type: "Fan meeting",
    title_en: "Lookmhee & Sonya 1st Fan Meeting in Macau",
    title_th: "แฟนมีตติ้งครั้งแรกที่มาเก๊า",
    title_zh: "澳门首场粉丝见面会",
    artists: "Lookmhee and Sonya",
    time: "04.00 PM",
    venue: "The Londoner Macao, Loulé Meeting Room",
    hashtag: "#LMSY1stFMInMacau"
  },
  {
    date: "2024-11-09",
    type: "TV",
    title_en: "The Big Kitchen",
    title_th: "The Big Kitchen",
    title_zh: "大厨房节目",
    artists: "Sonya (solo)",
    time: "09.30 AM",
    venue: "Workpoint 23",
    hashtag: "#TheBigKitchenxSonya"
  },
  {
    date: "2024-12-01",
    type: "Fan meeting",
    title_en: "Lookmhee & Sonya 1st Fan Meeting in Hong Kong",
    title_th: "แฟนมีตติ้งครั้งแรกที่ฮ่องกง",
    title_zh: "香港粉丝见面会",
    artists: "Lookmhee and Sonya",
    time: "03.00 PM to 05.00 PM",
    venue: "Eaton HK, 2/F Ballroom",
    hashtag: "#LMSYinHongKong"
  },
  {
    date: "2024-12-08",
    type: "Live",
    title_en: "TheTasteTime Taobao Live",
    title_th: "TheTasteTime ไลฟ์ Taobao",
    title_zh: "TheTasteTime 淘宝直播",
    artists: "Lookmhee and Sonya",
    time: "07.00 PM",
    venue: "Taobao Live",
    hashtag: "#TheTasteTime"
  },
  {
    date: "2024-12-14",
    type: "Brand",
    title_en: "Newtamins Merry X’Mas Meet and Greet",
    title_th: "Newtamins Merry X’Mas (Meet and Greet)",
    title_zh: "Newtamins 圣诞特别见面会",
    artists: "Sonya (solo)",
    time: "01.00 PM",
    venue: "Not stated",
    hashtag: "#NewtaminsMerryXMas"
  },
  {
    date: "2024-12-21",
    type: "Fan meeting",
    title_en: "Lookmhee 1st Fan Meeting in Nanning",
    title_th: "แฟนมีตติ้งเดี่ยว Lookmhee ที่หนานหนิง",
    title_zh: "Lookmhee 南宁首场粉丝见面会",
    artists: "Lookmhee (solo)",
    time: "12.30 PM",
    venue: "Baiyi Shanghecheng HOPELIVE, Nanning",
    hashtag: "#Lookmhee1stFMInNanning"
  },
  {
    date: "2024-12-21",
    type: "Fan meeting",
    title_en: "Sonya 1st Fan Meeting in Nanning",
    title_th: "แฟนมีตติ้งเดี่ยว Sonya ที่หนานหนิง",
    title_zh: "Sonya 南宁首场粉丝见面会",
    artists: "Sonya (solo)",
    time: "06.00 PM",
    venue: "Baiyi Shanghecheng HOPELIVE, Nanning",
    hashtag: "#Sonya1stFMInNanning"
  },
  {
    date: "2024-12-24",
    type: "Live",
    title_en: "Mystbelle Taobao Live",
    title_th: "Mystbelle ไลฟ์ Taobao",
    title_zh: "Mystbelle 淘宝直播",
    artists: "Lookmhee and Sonya",
    time: "07.00 PM",
    venue: "Taobao Live",
    hashtag: "#Mystbelle"
  },
  {
    date: "2024-12-28",
    type: "Brand",
    title_en: "ICONSIAM Pre Countdown Party",
    title_th: "ICONSIAM Pre Countdown Party",
    title_zh: "ICONSIAM 跨年前倒数派对",
    artists: "Lookmhee and Sonya",
    time: "07.00 PM",
    venue: "River Park, ICONSIAM",
    hashtag: "#ICONSIAMPreCountdown"
  },
  {
    date: "2025-01-08",
    type: "Press",
    title_en: "Lookmhee & Sonya Press Tour",
    title_th: "Press Tour Lookmhee & Sonya",
    title_zh: "Lookmhee & Sonya 宣传行程",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Not stated",
    hashtag: ""
  },
  {
    date: "2025-01-10",
    type: "Live",
    title_en: "Arousar Studios Taobao Live",
    title_th: "Arousar Studios ไลฟ์ Taobao",
    title_zh: "Arousar Studios 淘宝直播",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Taobao Live",
    hashtag: "#ArousarStudios"
  },
  {
    date: "2025-01-16",
    type: "Show",
    title_en: "T-POP Stage Show",
    title_th: "T-POP Stage Show",
    title_zh: "T-POP 舞台秀",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Not stated",
    hashtag: "#TPopStageShow"
  },
  {
    date: "2025-01-18",
    type: "Fansign",
    title_en: "Lookmhee & Sonya 1st Fansign in Tianjin",
    title_th: "แฟนไซน์ครั้งแรกที่เทียนจิน",
    title_zh: "天津首场签名会",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Tianjin",
    hashtag: "#LMSY1stFansignInTianjin"
  },
  {
    date: "2025-01-23",
    type: "Fashion",
    title_en: "Sretsis In Store Launch (Resort 2025 Love Frontier)",
    title_th: "Sretsis In Store Launch (Resort 2025 Love Frontier)",
    title_zh: "Sretsis 门店活动（Resort 2025 Love Frontier）",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Sretsis store",
    hashtag: "#SRETSIS"
  },
  {
    date: "2025-01-24",
    type: "Press",
    title_en: "Lookmhee & Sonya Press Tour",
    title_th: "Press Tour Lookmhee & Sonya",
    title_zh: "Lookmhee & Sonya 宣传行程",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "Not stated",
    hashtag: ""
  },
  {
    date: "2025-02-15",
    type: "Fan meeting",
    title_en: "LMSY 1st Fan Meeting in Thailand (Be My Valentine)",
    title_th: "แฟนมีตติ้ง LMSY ครั้งแรกในไทย (Be My Valentine)",
    title_zh: "LMSY 泰国首场粉丝见面会（Be My Valentine）",
    artists: "Lookmhee and Sonya",
    time: "Not stated",
    venue: "TRUE ICON HALL, 7th Floor, ICONSIAM",
    hashtag: "#LMSY1stFMInThailand"
  }
];

function parseISODate(iso) {
  const [y,m,d] = iso.split('-').map(Number);
  return new Date(Date.UTC(y, m-1, d));
}

function formatDay(dt) {
  return dt.getUTCDate().toString().padStart(2,'0');
}

function formatMonthShort(dt) {
  return dt.toLocaleString('en-GB', { month: 'short', timeZone: 'UTC' });
}

function formatMonthHeader(dt) {
  return dt.toLocaleString('en-GB', { month: 'long', year: 'numeric', timeZone: 'UTC' });
}

function uniqueSorted(arr) {
  return Array.from(new Set(arr)).sort();
}

function xSearchLink(tag) {
  const clean = tag.startsWith('#') ? tag : ('#' + tag);
  return 'https://x.com/search?q=' + encodeURIComponent(clean);
}

function buildFilters() {
  const yearSelect = document.getElementById('filter-year');
  const monthSelect = document.getElementById('filter-month');
  const typeSelect = document.getElementById('filter-type');

  const years = uniqueSorted(events.map(e => parseISODate(e.date).getUTCFullYear())).sort((a,b)=>b-a);
  yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
  yearSelect.insertAdjacentHTML('beforeend', `<option value="all">All</option>`);
  yearSelect.value = "all";

  const types = uniqueSorted(events.map(e => e.type)).filter(Boolean);
  typeSelect.innerHTML = `<option value="all">All</option>` + types.map(t => `<option value="${t}">${t}</option>`).join('');

  const months = [
    'January','February','March','April','May','June','July','August','September','October','November','December'
  ];
  monthSelect.innerHTML = `<option value="all">All</option>` + months.map((m,i)=>`<option value="${i+1}">${m}</option>`).join('');

  const rerender = () => render();
  yearSelect.addEventListener('change', rerender);
  monthSelect.addEventListener('change', rerender);
  typeSelect.addEventListener('change', rerender);
}

function eventMatchesFilters(e, filters) {
  const dt = parseISODate(e.date);
  const y = dt.getUTCFullYear();
  const m = dt.getUTCMonth()+1;

  if (filters.year !== 'all' && Number(filters.year) !== y) return false;
  if (filters.month !== 'all' && Number(filters.month) !== m) return false;
  if (filters.type !== 'all' && filters.type !== e.type) return false;
  return true;
}

function render() {
  const schedule = document.getElementById('schedule');
  const year = document.getElementById('filter-year').value;
  const month = document.getElementById('filter-month').value;
  const type = document.getElementById('filter-type').value;

  const filters = { year, month, type };

  const filtered = events
    .slice()
    .sort((a,b)=>parseISODate(a.date)-parseISODate(b.date))
    .filter(e => eventMatchesFilters(e, filters));

  if (!filtered.length) {
    schedule.innerHTML = `<p class="empty">No events found for the selected filters.</p>`;
    return;
  }

  let html = '';
  let currentHeader = '';

  for (const e of filtered) {
    const dt = parseISODate(e.date);
    const header = formatMonthHeader(dt);
    if (header !== currentHeader) {
      currentHeader = header;
      html += `<h3 class="month-header">${header}</h3>`;
    }

    const day = formatDay(dt);
    const mon = formatMonthShort(dt);

    const metaParts = [];
    if (e.time && e.time.trim()) metaParts.push(`Time: ${e.time}`);
    if (e.venue && e.venue.trim()) metaParts.push(`Venue: ${e.venue}`);
    if (e.artists && e.artists.trim()) metaParts.push(`Artists: ${e.artists}`);
    const meta = metaParts.join(' | ');

    const langs = [];
    if (e.title_th) langs.push(`TH: ${e.title_th}`);
    if (e.title_zh) langs.push(`CN: ${e.title_zh}`);

    let hashtagHtml = '';
    if (e.hashtag && e.hashtag.trim()) {
      hashtagHtml = `<div class="event-hashtags"><a href="${xSearchLink(e.hashtag)}" target="_blank" rel="noopener noreferrer">${e.hashtag}</a></div>`;
    }

    html += `
      <div class="event-card">
        <div class="event-date">
          <div class="event-day">${day}</div>
          <div class="event-month">${mon}</div>
        </div>
        <div class="event-main">
          <div class="event-title">${e.title_en}</div>
          <div class="event-meta">${meta}</div>
          <div class="event-meta event-meta-secondary">${langs.join(' | ')}</div>
          <div class="event-meta event-meta-secondary">Type: ${e.type}</div>
          ${hashtagHtml}
        </div>
      </div>
    `;
  }

  schedule.innerHTML = html;
}

document.addEventListener('DOMContentLoaded', () => {
  buildFilters();
  render();
});
